---
title: "swstr_modeling"
author: "Owen McGrattan"
date: "10/21/2018"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# load in packages
library(dplyr)
library(ggplot2)
library(baseballr)
library(readr)
library(randomForest)
library(stats)
library(glmnet)
library(caret)
```

```{r}
# read in grouped df
df <- read_csv("swstr_pitchers.csv", 
    col_types = cols(X1 = col_skip()))

# rename our fastball velo column appropriately
colnames(df)[which(names(df) == "fb_diff")] <- "fb_velo"
```
```{r}
ggplot(data.frame(df$pitch_type), aes(df$pitch_type)) + geom_bar(fill = "blue4") + labs(x = "Pitch Type") 
```

- If we're fitting a model it may just be best to leave the forkballs, knuckles, and ephuses out. 

- How do these pitches look on a movement spectrum?

```{r}
ggplot(filter(df, len > 150)) + geom_point(aes(x = pfx_x, y = pfx_z, color = pitch_type))
```



```{r}
# shrink our sample down to those who have thrown at least 150 of an offspeed pitch, none of the more obscure offspeed offerings.
samp <- df %>% filter(len >= 150, pitch_type != "KN", pitch_type != "FO", pitch_type != "EP")
```


```{r}
# random forest
samp$pitch_type <- as.factor(samp$pitch_type)
samp$handedness <- as.factor(samp$handedness)
b <- randomForest(formula = swstr ~ .,
                data = samp[,-c(1, 3)], na.action = na.omit)
print(b)
```


```{r}
varImpPlot(b)
```

- Our second important variable in this situation was vertical movement which isn't too surprising considering you want pitches that move up and down rather than those that travel more left-right along the barrel.  Also not surprising was the fact that velocity, both of the offspeed pitch and average FB velo was incredibly important.  I was curious to see that release height played such a factor, moreso than horizontal movement.  It could be some sort of tuning due to extreme outliers in release point or more that horizontal movement doesn't tell us much at all for whiffs. 

- Taking a general overview of our model, an R^2 of ~ 0.41/.42 tells us a strong deal given just pure "stuff" and not taking the context of each individual pitch.  Of course there's a good deal of variation that we should not expect to be explained in the data I fed into the model.  While I do give pct usage and total num of pitches thrown, I do not give any information about pitch location, usage by count, sequencing, batter handedness, leverage, so on and so forth. 

- We've put together a decent model but it has a finite application.  Given that swstr% is something that'll stabilize fairly quickly it doesn't necessarily help identify current MLB candidates that will see a jump in performance, we can simply look at MLB pitchers who generate a strong amount of whiffs on one or more misused offspeed pitches.  This prediction is something that better serves identifying the minor league talent (in an ideal scenario where we have movement data on these pitches) who project to produce above average whiffs and therefore strikeouts. It'd greatly benefit our model to include swstr%'s for given players in our data set who have pitched in either the AA or AAA level.  Unfortunately, while we can grab swstr% for pitchers, we do not have publically available pitch-by-pitch data with each pitch type tracked. 


